# 多物体分类规则表

## 规则1：手机截图优先规则

| 检测条件 | 分类结果 | 优先级 | 说明 |
|---------|---------|--------|------|
| 宽高比<=0.5 + 文件名包含screenshot/截图/screen | 手机截图 | 1 | 手机截图，最高优先级 |
| 宽高比<=0.5 + 文件名包含Screenshot/截图/Screen | 手机截图 | 1 | 不区分大小写 |
| 宽高比<=0.5（手机竖屏比例，包括滚动截图） | 手机截图 | 1 | 仅凭比例判定 |
| 文件名包含截图关键词 | 手机截图 | 1 | 仅凭文件名判定 |

## 规则2：身份证优先规则

| 检测到物体 | 分类结果 | 优先级 | 说明 |
|-----------|---------|--------|------|
| id_card_front | idcard | 2 | 身份证正面，直接分类 |
| id_card_back | idcard | 2 | 身份证背面，直接分类 |
| id_card_front + id_card_back | idcard | 2 | 双面身份证，直接分类 |

## 规则3：场景组合识别规则

| 场景类型 | 必需物体 | 可选物体 | 最少数量 | 分类结果 | 优先级 |
|---------|---------|---------|---------|---------|--------|
| 工作场景 | laptop | mouse, keyboard, book, cell phone | 2 | document | 3 |
| 会议场景 | person, laptop | chair, dining table, book | 3 | meeting | 3 |
| 生活场景 | bottle, cup, bowl | tv, couch, bed, refrigerator | 3 | life | 4 |
| 宠物场景 | cat, dog, bird | person, teddy bear | 2 | pet | 4 |
| 美食场景 | pizza, cake, sandwich | bottle, cup, bowl | 2 | food | 4 |
| 旅行场景 | car, airplane, train | person, suitcase | 2 | travel | 4 |
| 运动娱乐场景 | sports ball, frisbee | person, skateboard | 2 | game | 4 |

## 规则4：单一物体分类规则

| 物体类别 | 分类结果 | 置信度聚合方式 | 说明 |
|---------|---------|---------------|------|
| person | people | 取最高 | 人物优先 |
| cat, dog, bird, horse, sheep, cow, elephant, bear, zebra, giraffe | pet | 加权平均 | 宠物类 |
| bottle, wine glass, cup, fork, knife, spoon, bowl, tv, couch, bed, dining table, toilet, microwave, oven, toaster, sink, refrigerator, clock, vase, scissors, teddy bear, hair drier, toothbrush | life | 加权平均 | 生活用品 |
| banana, apple, sandwich, orange, broccoli, carrot, hot dog, pizza, donut, cake | food | 加权平均 | 食物类 |
| laptop, mouse, keyboard, cell phone, book | document | 加权平均 | 工作文档 |
| car, motorcycle, airplane, bus, train, truck, boat, bicycle | travel | 加权平均 | 交通工具 |
| sports ball, frisbee, skis, snowboard, kite, baseball bat, baseball glove, skateboard, surfboard, tennis racket | game | 加权平均 | 运动娱乐 |
| 其他未映射物体 | other | 加权平均 | 其他分类 |

## 规则5：多标签支持规则

| 分类数量 | 返回方式 | 置信度阈值 | 说明 |
|---------|---------|-----------|------|
| 1个分类 | 直接返回 | > 0.5 | 单一分类 |
| 2-3个分类 | 按置信度排序 | > 0.3 | 多标签分类 |
| 4个以上 | 取前3个 | > 0.3 | 限制数量 |

## 规则6：置信度聚合计算方式

| 聚合方式 | 计算公式 | 适用场景 | 说明 |
|---------|---------|---------|------|
| 取最高 | max(confidences) | 单一物体 | 只考虑最高置信度 |
| 加权平均 | sum(confidences) / count | 同类物体 | 同类物体置信度平均 |
| 场景加权 | sum(confidences) * 1.2 | 场景组合 | 场景识别加权 |
| 多标签 | 分别计算 | 多分类 | 每个分类独立计算 |

## 规则7：特殊处理规则

| 特殊情况 | 处理方式 | 说明 |
|---------|---------|------|
| 无检测结果 | 分类为 other | 默认分类 |
| 置信度过低 | 过滤掉 | 阈值 < 0.25 |
| 物体重叠 | 取最高置信度 | 避免重复计算 |
| 场景冲突 | 按优先级选择 | 手机截图 > 身份证 > 场景 > 单一物体 |

## 规则8：分类优先级总表

| 优先级 | 分类类型 | 分类结果 | 触发条件 |
|-------|---------|---------|---------|
| 1 | 手机截图 | 手机截图 | 宽高比0.4-0.6 + 文件名包含截图关键词 |
| 2 | 身份证 | idcard | 检测到 id_card_front 或 id_card_back |
| 3 | 场景组合 | document/meeting | 工作场景或会议场景组合 |
| 4 | 单一物体 | people/pet/life/food/document/travel/game | 单一物体检测 |
| 5 | 默认分类 | other | 无有效检测结果 |

## 规则9：置信度阈值设置

| 检测类型 | 阈值 | 说明 |
|---------|------|------|
| 身份证检测 | 0.3 | 身份证模型置信度阈值 |
| 通用物体检测 | 0.25 | YOLOv8模型置信度阈值 |
| 场景组合识别 | 0.3 | 场景组合最低置信度 |
| 多标签分类 | 0.3 | 多标签最低置信度 |
| 最终分类 | 0.5 | 最终分类最低置信度 |

## 规则10：实现逻辑流程

```
1. 手机截图检测
   ├── 宽高比0.4-0.6 + 文件名包含截图关键词 → 返回 手机截图
   └── 不满足条件 → 继续身份证检测

2. 身份证检测
   ├── 检测到身份证 → 返回 idcard
   └── 未检测到身份证 → 继续通用检测

3. 通用物体检测
   ├── 场景组合识别
   │   ├── 工作场景 → document
   │   ├── 会议场景 → meeting
   │   └── 其他场景 → 继续单一物体分类
   └── 单一物体分类
       ├── 按物体类别映射
       ├── 置信度聚合计算
       └── 多标签支持

4. 最终分类
   ├── 按优先级选择
   ├── 置信度阈值过滤
   └── 返回分类结果
```

## 规则11：测试用例

| 测试场景 | 检测物体 | 期望分类 | 置信度 |
|---------|---------|---------|-------|
| 手机截图 | 宽高比0.5 + 文件名包含screenshot | 手机截图 | 1.0 |
| 身份证正面 | id_card_front (0.95) | idcard | 0.95 |
| 工作场景 | laptop (0.88) + mouse (0.82) | document | 0.85 |
| 会议场景 | person (0.90) + laptop (0.85) + chair (0.78) | meeting | 0.84 |
| 宠物场景 | cat (0.92) + person (0.88) | pet | 0.90 |
| 美食场景 | pizza (0.89) + bottle (0.75) | food | 0.82 |
| 旅行场景 | car (0.91) + person (0.85) | travel | 0.88 |
| 运动娱乐场景 | sports ball (0.87) + person (0.83) | game | 0.85 |
| 多物体场景 | person (0.90) + laptop (0.85) + cat (0.80) | people | 0.90 |
| 无检测结果 | 无 | other | 0.0 |
